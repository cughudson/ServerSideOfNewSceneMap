<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"></meta>
    <title>测试</title>
</head>
<body>
<form id="form" action="/upload?name=test" method="POST" enctype="multipart/form-data" onsubmit="return upload();">
    <input type="file" name="file"/>
    <input id="name"  value="test" >
    <br/>
    <input type="submit" value="提交" />
</form>
</body>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery.form/4.2.2/jquery.form.min.js"></script>
<script>
    function upload() {
        $("#form").ajaxSubmit(function(message) {
            console.log("ajax submit success");
            console.log(message);
            clearInterval(interval);
        });
        // 500ms 打印一次当前的上传进度
        let interval=setInterval(function () {
            $.ajax({
                type:"post",
                dataType: 'json',
                url:"/uploadStatus?name="+$("#name").val(),
                success: function(result){
                    console.log(result);
                    $("html").append(JSON.stringify(result)+"<br>");
                    if(parseInt(result)==100){
                        console.log('end ..............');
                        clearInterval(interval);
                    }
                }
            });
        }, 3000);
        return false;
    }
</script>
</html>